version: 2

seeds:
  - name: dim_date
    description: "Dimension table for dates table"
    columns:
      - name: date_id
        description: "Primary Key for dim_date"
        tests:
          - not_null
          - dbt_constraints.primary_key
models:
  - name: dim_company
    description: "Dimension table from company staging"
    columns:
      - name: company_id
        description: "Primary key for company"
        tests:
          - not_null
          - dbt_constraints.primary_key

  - name: dim_acquisition
    description: "Dimension table from acquisition staging"
    columns:
      - name: acquisition_id
        description: "Surrogate Key for acquisition"
        tests:
          - not_null
          - dbt_constraints.primary_key

      - name: dim_acquisition.nk_acquisition
        description: "Natural Key for acquisition"
        tests:
          - not_null
      
      - name: acquiring_object_id
        description: "Foreign Key to acquiring_object_id"
        tests:
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_company')
              pk_column_name: company_id

      - name: acquired_object_id
        description: "Foreign Key to acquired_object_id"
        tests:
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_company')
              pk_column_name: company_id

      - name: acquired_at
        description: "Foreign Key to date"
        tests:
          - dbt_constraints.foreign_key:
              pk_table_name: ref('dim_date')
              pk_column_name: date_actual
